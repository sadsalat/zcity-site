<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="style.css" rel="stylesheet">
</head>
<body>
	<canvas id="grid"></canvas>
    <div class="gradient"></div>
	<div class="centertext">
		<span class="text_1">Z</span>
		<span class="text_1" style="color:white;">City</span>
        <div style="margin-top: -2vh;">
            <span class="info" id="info" style="font-weight: 500;">There is nothing for you... sorry :3</span>
            <br>
            <span class="info" id="map"></span>
            <br>
            <span id="text_tips" tip>Hey where tips?</span>
        </div>
	</div>
    <span class="info-down">zcity-help.ru</span>

    <script>
        const canvas = document.getElementById('grid');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth+25;
        canvas.height = window.innerHeight+25;
        canvas.position = "absolute"
        
        const gridSize = 60;
        let offsetX = window.innerWidth;
        let offsetY = -window.innerHeight;
        const gridColor = 'rgba(99, 88, 104, 0.05)';
        
        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let x = offsetX % gridSize; x < canvas.width + gridSize; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.strokeStyle = gridColor;
                ctx.lineWidth = 2.5;
                ctx.stroke();
            }

            for (let y = offsetY % gridSize; y < canvas.height + gridSize; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.strokeStyle = gridColor;
                ctx.lineWidth = 2.5;
                ctx.stroke();
            }

            offsetX -= Math.min(Math.max(Math.sin(Date.now() / 10000), -0.2), 0.2);
            offsetY += 0.2;

            requestAnimationFrame(drawGrid);
        }

        drawGrid();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>

    <script>
        const currentLang = navigator.language;
        function SelectTip() {
            const newLang = (currentLang === 'ru-RU' || currentLang === 'ru') ? 'ru' : 'en';

            fetch(`tips/${newLang}.json`)
                .then(response => response.json())
                .then(translationData => {
                    document.querySelectorAll('[tip]').forEach(element => {
                        var keys = Object.keys(translationData)
                        const key = keys[Math.floor(Math.random() * keys.length)]
                        //console.log(key)
                        if (translationData[key]) {
                            element.textContent = translationData[key];
                        }
                    });   
                })
                .catch(error => console.error('Error loading language file:', error)); 
        }
        const changingText = document.getElementById('text_tips');
        function changeText(){
            changingText.style.opacity = 0;
            changingText.addEventListener('transitionend', handleTransitionEnd, { once: true });
            function handleTransitionEnd(){
                changingText.style.opacity = 1;
                SelectTip()
                startThink()
                //changingText.classList.remove('fade-out');
                //SelectTip()
            }
            
        }

        function startThink(){
            setTimeout(() => {
                changeText()
                //startThink()
            },12000)
        }
        setTimeout(() => {changeText()},500)


        const infoText = document.getElementById('info');
        const mapText = document.getElementById('map');
        function GameDetails( servername, serverurl, mapname, maxplayers, steamid, gamemode, volume, language ) {
            infoText.textContent = servername.split("|")[2].trim()
            mapText.textContent = "On map: " + mapname
            currentLang = language
        }
    </script>
</body>
</html>